<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Wayland Server API: wl_shm_buffer Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Wayland Server API
   &#160;<span id="projectnumber">1.16.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle">
<div class="title">wl_shm_buffer Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for wl_shm_buffer:</div>
<div class="dyncontent">
<div class="center"><img src="structwl__shm__buffer__coll__graph.png" border="0" usemap="#wl__shm__buffer_coll__map" alt="Collaboration graph"/></div>
<map name="wl__shm__buffer_coll__map" id="wl__shm__buffer_coll__map">
<area shape="rect" id="node2" href="structwl__resource.html" title="wl_resource" alt="" coords="423,261,523,288"/>
<area shape="rect" id="node8" href="structwl__client.html" title="wl_client" alt="" coords="117,381,197,408"/>
<area shape="rect" id="node13" href="structwl__shm__pool.html" title="wl_shm_pool" alt="" coords="615,381,721,408"/>
<area shape="rect" id="node3" href="structwl__signal.html" title="A source of a type of observable event. " alt="" coords="271,112,353,139"/>
<area shape="rect" id="node4" href="structwl__list.html" title="Doubly&#45;linked list. " alt="" coords="155,7,219,33"/>
<area shape="rect" id="node10" href="structwl__display.html" title="wl_display" alt="" coords="123,471,213,497"/>
<area shape="rect" id="node5" href="structwl__object.html" title="wl_object" alt="" coords="547,112,631,139"/>
<area shape="rect" id="node6" href="structwl__interface.html" title="Protocol object interface. " alt="" coords="450,7,553,33"/>
<area shape="rect" id="node7" href="structwl__message.html" title="Protocol message signature. " alt="" coords="421,112,523,139"/>
<area shape="rect" id="node9" href="structwl__event__source.html" title="An abstract event source. " alt="" coords="193,261,324,288"/>
<area shape="rect" id="node11" href="structwl__event__loop.html" title="An event loop context. " alt="" coords="222,381,338,408"/>
<area shape="rect" id="node12" href="structwl__array.html" title="Dynamic array. " alt="" coords="362,381,441,408"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a9104a38eae80c5ba92c8ab030c70192f"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwl__shm__buffer.html#a9104a38eae80c5ba92c8ab030c70192f">wl_shm_buffer_get_data</a> (struct <a class="el" href="structwl__shm__buffer.html">wl_shm_buffer</a> *buffer)</td></tr>
<tr class="memdesc:a9104a38eae80c5ba92c8ab030c70192f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a pointer to the memory for the SHM buffer.  <a href="#a9104a38eae80c5ba92c8ab030c70192f">More...</a><br /></td></tr>
<tr class="separator:a9104a38eae80c5ba92c8ab030c70192f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc49a49c3586821d6ec4efe7ea915305"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structwl__shm__pool.html">wl_shm_pool</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwl__shm__buffer.html#abc49a49c3586821d6ec4efe7ea915305">wl_shm_buffer_ref_pool</a> (struct <a class="el" href="structwl__shm__buffer.html">wl_shm_buffer</a> *buffer)</td></tr>
<tr class="memdesc:abc49a49c3586821d6ec4efe7ea915305"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a reference to a shm_buffer's shm_pool.  <a href="#abc49a49c3586821d6ec4efe7ea915305">More...</a><br /></td></tr>
<tr class="separator:abc49a49c3586821d6ec4efe7ea915305"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a809cb5d6b33338c62bbca6daa4138667"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwl__shm__buffer.html#a809cb5d6b33338c62bbca6daa4138667">wl_shm_buffer_begin_access</a> (struct <a class="el" href="structwl__shm__buffer.html">wl_shm_buffer</a> *buffer)</td></tr>
<tr class="memdesc:a809cb5d6b33338c62bbca6daa4138667"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark that the given SHM buffer is about to be accessed.  <a href="#a809cb5d6b33338c62bbca6daa4138667">More...</a><br /></td></tr>
<tr class="separator:a809cb5d6b33338c62bbca6daa4138667"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a030db6056ef08836e9dee21a8087e2c1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwl__shm__buffer.html#a030db6056ef08836e9dee21a8087e2c1">wl_shm_buffer_end_access</a> (struct <a class="el" href="structwl__shm__buffer.html">wl_shm_buffer</a> *buffer)</td></tr>
<tr class="memdesc:a030db6056ef08836e9dee21a8087e2c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ends the access to a buffer started by wl_shm_buffer_begin_access.  <a href="#a030db6056ef08836e9dee21a8087e2c1">More...</a><br /></td></tr>
<tr class="separator:a030db6056ef08836e9dee21a8087e2c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a3d12a4cd03248384cc49f1967344f046"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structwl__resource.html">wl_resource</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwl__shm__buffer.html#a3d12a4cd03248384cc49f1967344f046">resource</a></td></tr>
<tr class="separator:a3d12a4cd03248384cc49f1967344f046"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a492d59af93895995ccfe29b760a0b811"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwl__shm__buffer.html#a492d59af93895995ccfe29b760a0b811">width</a></td></tr>
<tr class="separator:a492d59af93895995ccfe29b760a0b811"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c79094063656728405934894c49a90d"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwl__shm__buffer.html#a4c79094063656728405934894c49a90d">height</a></td></tr>
<tr class="separator:a4c79094063656728405934894c49a90d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adccfaf9f4b79f1e3539499ce67c74222"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwl__shm__buffer.html#adccfaf9f4b79f1e3539499ce67c74222">stride</a></td></tr>
<tr class="separator:adccfaf9f4b79f1e3539499ce67c74222"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab62701b55dde79ce9beb612d40712570"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwl__shm__buffer.html#ab62701b55dde79ce9beb612d40712570">format</a></td></tr>
<tr class="separator:ab62701b55dde79ce9beb612d40712570"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c942587694f130e247d705ec793d3d7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwl__shm__buffer.html#a9c942587694f130e247d705ec793d3d7">offset</a></td></tr>
<tr class="separator:a9c942587694f130e247d705ec793d3d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16f66addfe9b94906e8a0bf21653b81b"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structwl__shm__pool.html">wl_shm_pool</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwl__shm__buffer.html#a16f66addfe9b94906e8a0bf21653b81b">pool</a></td></tr>
<tr class="separator:a16f66addfe9b94906e8a0bf21653b81b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a809cb5d6b33338c62bbca6daa4138667"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a809cb5d6b33338c62bbca6daa4138667">&#9670;&nbsp;</a></span>wl_shm_buffer_begin_access()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wl_shm_buffer_begin_access </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structwl__shm__buffer.html">wl_shm_buffer</a> *&#160;</td>
          <td class="paramname"><em>buffer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mark that the given SHM buffer is about to be accessed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>The SHM buffer</td></tr>
  </table>
  </dd>
</dl>
<p>An SHM buffer is a memory-mapped file given by the client. According to POSIX, reading from a memory-mapped region that extends off the end of the file will cause a SIGBUS signal to be generated. Normally this would cause the compositor to terminate. In order to make the compositor robust against clients that change the size of the underlying file or lie about its size, you should protect access to the buffer by calling this function before reading from the memory and call wl_shm_buffer_end_access afterwards. This will install a signal handler for SIGBUS which will prevent the compositor from crashing.</p>
<p>After calling this function the signal handler will remain installed for the lifetime of the compositor process. Note that this function will not work properly if the compositor is also installing its own handler for SIGBUS.</p>
<p>If a SIGBUS signal is received for an address within the range of the SHM pool of the given buffer then the client will be sent an error event when wl_shm_buffer_end_access is called. If the signal is for an address outside that range then the signal handler will reraise the signal which would will likely cause the compositor to terminate.</p>
<p>It is safe to nest calls to these functions as long as the nested calls are all accessing the same buffer. The number of calls to wl_shm_buffer_end_access must match the number of calls to wl_shm_buffer_begin_access. These functions are thread-safe and it is allowed to simultaneously access different buffers or the same buffer from multiple threads. </p>

</div>
</div>
<a id="a030db6056ef08836e9dee21a8087e2c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a030db6056ef08836e9dee21a8087e2c1">&#9670;&nbsp;</a></span>wl_shm_buffer_end_access()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wl_shm_buffer_end_access </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structwl__shm__buffer.html">wl_shm_buffer</a> *&#160;</td>
          <td class="paramname"><em>buffer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Ends the access to a buffer started by wl_shm_buffer_begin_access. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>The SHM buffer</td></tr>
  </table>
  </dd>
</dl>
<p>This should be called after wl_shm_buffer_begin_access once the buffer is no longer being accessed. If a SIGBUS signal was generated in-between these two calls then the resource for the given buffer will be sent an error. </p>

</div>
</div>
<a id="a9104a38eae80c5ba92c8ab030c70192f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9104a38eae80c5ba92c8ab030c70192f">&#9670;&nbsp;</a></span>wl_shm_buffer_get_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * wl_shm_buffer_get_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structwl__shm__buffer.html">wl_shm_buffer</a> *&#160;</td>
          <td class="paramname"><em>buffer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a pointer to the memory for the SHM buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>The buffer object</td></tr>
  </table>
  </dd>
</dl>
<p>Returns a pointer which can be used to read the data contained in the given SHM buffer.</p>
<p>As this buffer is memory-mapped, reading from it may generate SIGBUS signals. This can happen if the client claims that the buffer is larger than it is or if something truncates the underlying file. To prevent this signal from causing the compositor to crash you should call wl_shm_buffer_begin_access and wl_shm_buffer_end_access around code that reads from the memory. </p>

</div>
</div>
<a id="abc49a49c3586821d6ec4efe7ea915305"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc49a49c3586821d6ec4efe7ea915305">&#9670;&nbsp;</a></span>wl_shm_buffer_ref_pool()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structwl__shm__pool.html">wl_shm_pool</a> * wl_shm_buffer_ref_pool </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structwl__shm__buffer.html">wl_shm_buffer</a> *&#160;</td>
          <td class="paramname"><em>buffer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a reference to a shm_buffer's shm_pool. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer</td><td>The buffer object</td></tr>
  </table>
  </dd>
</dl>
<p>Returns a pointer to a buffer's shm_pool and increases the shm_pool refcount.</p>
<p>The compositor must remember to call wl_shm_pool_unref when it no longer needs the reference to ensure proper destruction of the pool.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="structwl__shm__pool.html#a2349156a6b7940645a4754e6c1690051" title="Unreference a shm_pool. ">wl_shm_pool_unref</a> </dd></dl>

</div>
</div>
<h2 class="groupheader">Field Documentation</h2>
<a id="ab62701b55dde79ce9beb612d40712570"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab62701b55dde79ce9beb612d40712570">&#9670;&nbsp;</a></span>format</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t wl_shm_buffer::format</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4c79094063656728405934894c49a90d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c79094063656728405934894c49a90d">&#9670;&nbsp;</a></span>height</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t wl_shm_buffer::height</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9c942587694f130e247d705ec793d3d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c942587694f130e247d705ec793d3d7">&#9670;&nbsp;</a></span>offset</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int wl_shm_buffer::offset</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a16f66addfe9b94906e8a0bf21653b81b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16f66addfe9b94906e8a0bf21653b81b">&#9670;&nbsp;</a></span>pool</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structwl__shm__pool.html">wl_shm_pool</a>* wl_shm_buffer::pool</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3d12a4cd03248384cc49f1967344f046"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d12a4cd03248384cc49f1967344f046">&#9670;&nbsp;</a></span>resource</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structwl__resource.html">wl_resource</a>* wl_shm_buffer::resource</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="adccfaf9f4b79f1e3539499ce67c74222"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adccfaf9f4b79f1e3539499ce67c74222">&#9670;&nbsp;</a></span>stride</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t wl_shm_buffer::stride</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a492d59af93895995ccfe29b760a0b811"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a492d59af93895995ccfe29b760a0b811">&#9670;&nbsp;</a></span>width</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t wl_shm_buffer::width</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>/dev/shm/libwayland/wayland/src/<a class="el" href="wayland-shm_8c.html">wayland-shm.c</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Sep 6 2018 13:02:11 for Wayland Server API by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
